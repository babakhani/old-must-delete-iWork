<control iv-redirecturl="null" iv-title="null" iv-show-message="true"  iv-show-modal="false" >
    <div class="form-container" ng-controller="$iv-controller_$iv-action" onsubmit="return false;">
        <h3 class="panel-title" ng-show="showFormTitle">$iv-title</h3>
        <form name="$iv-name" class="form-horizontal">
            <iv-content>
            </iv-content>
            <div class="alert alert-dismissable alert-danger" ng-show="showErrorMessage && messageEnabled">
                {{result.Message}}
            </div>
            <div class="alert alert-dismissable alert-success" ng-show="showSuccessMessage && messageEnabled">
                {{result.Message}}
            </div>
            <result>
            </result>
        </form>
    </div>
    <modal iv-type="modal" iv-modal-id="formSuccessModal">
        <iv-modalbody>
            <h3>$iv-controller Add/Update Successfully.</h3>
            <button iv-type="cancel" iv-label="Done" ></button>
        </iv-modalbody>
    </modal>
    <script>
        function $iv-controller_$iv-action($rootScope,$scope, $element, $location, $window, $http) {
            $scope.messageEnabled = $iv-show-message;
            $scope.isFormSubmitted = false;
            $scope.showFormTitle = '$iv-title' !== 'null';
            $scope.formUpdate = function(entityID){
                console.log("$scope.formUpdate  " + entityID)
                $http({
                    method  : 'GET',
                    url     : rootControllerUrl + "$iv-controller/GetById",
                    data: {
                        ContactId: entityID
                    },
                    headers : { 'Content-Type': 'application/x-www-form-urlencoded' }
                }).
                success(function (responseData, status, headers, config) {
                }).
                error(function (responseData, status, headers, config) {
                });
            }
            $scope.formreset = function () {
                $element.find('form').find("input[type=tel],input[type=text], textarea").val("");
                $scope.showErrorMessage = false;
                $scope.showSuccessMessage = false;
            }
            $scope.formsubmit = function () {

                console.log('form submit called')

                if( $element.find('form .ng-invalid').length > 0){
                    return false;
                }
                $element.find('form [type=submit]').button('loading');
                $http({
                    method  : 'POST',
                    url     : rootControllerUrl + "$iv-controller/$iv-action",
                    data    : $element.find('form').serialize(),
                    headers : { 'Content-Type': 'application/x-www-form-urlencoded' }
                }).
                success(function (responseData, status, headers, config) {
                    $scope.isFormSubmitted = true;
                    $scope.result = responseData;
                    if (responseData.HasError == 'True')
                    {
                        $scope.showErrorMessage = true;
                        $scope.showSuccessMessage = false;
                        $scope.error = responseData.Error;
                        
                    }
                    else
                    {
                        $scope.showErrorMessage =false;
                        $scope.showSuccessMessage = true;
                        $rootScope.$broadcast('$iv-name', responseData);
                        if ("$iv-redirecturl" !== "null"){
                            $window.location = "$iv-redirecturl";
                        }
                        
                    }
                    $(window).trigger('resize');
                    $element.find('form [type=submit]').button('reset');
                    if($iv-show-modal !== false){
                        $('#formSuccessModal').modal('show');
                        $element.find('form').find("input[type=tel],input[type=text], textarea").val("");
                    }
                }).
                error(function (responseData, status, headers, config) {
                    $scope.showErrorMessage =true;
                    $scope.showSuccessMessage = false;
                    $scope.isFormSubmitted = true;
                    $scope.result = responseData;
                    $scope.error = responseData.Error;
                    $element.find('form [type=submit]').button('reset');
                })
            };
        }
    </script>
</control>