<control iv-redirecturl="null"
         iv-title="null"
         iv-controller="formDefaultController"
         iv-action="formDefaultAction"
         iv-show-message="true"
         iv-show-modal="false"
         iv-form-name="$iv-name"
         iv-single-submit="false"
         iv-filtering-form="false">
    <div class="form-container" ng-controller="$iv-name_form" onsubmit="return false;">
        <h3 class="panel-title" ng-show="showFormTitle">$iv-title</h3>
        <form name="$iv-name" class="form-horizontal">
            <iv-content>
            </iv-content>
            <div class="alert alert-dismissable alert-danger" ng-show="showErrorMessage && messageEnabled">
                {{result.Message}}
            </div>
            <div class="alert alert-dismissable alert-success" ng-show="showSuccessMessage && messageEnabled">
                {{result.Message}}
            </div>
            <result>
            </result>
        </form>
    </div>
    <modal iv-type="modal" iv-modal-id="formSuccessModal">
        <iv-modalbody>
            <h3>$iv-controller Add/Update Successfully.</h3>
            <button iv-type="cancel" iv-label="Done"></button>
        </iv-modalbody>
    </modal>
    <script>
        function $iv-name_form($rootScope,$scope, $element, $location, $window, $http) {
            $scope.messageEnabled = $iv-show-message;
            $scope.isFormSubmitted = false;
            $scope.showFormTitle = '$iv-title' !== 'null';
            $scope.$form =  $element.find('form')
            /* Update Form
            ---------------------------------------*/
            $scope.formUpdate = function(entityID){
                var slickIndex =  $scope.$form.parents('.slick-slide').data('slick-index');
                $('.slick-container').slick('slickGoTo', slickIndex);
                /*  Sample Data for update form */
                var sampleData = {
                    Company: "qqqqqqqqqqqqq",
                    ContactId: 16,
                    Description: "qqqqqqqqqq",
                    Fullname: "qqqqd",
                    Gender: 0,
                    Tel1: "qqqqqqqqqqqq",
                    Tel2: "qqqqqqqqqqqq",
                    Tel3: "qqqqqqqqqqqq",
                    Tel4: "qqqqqqqqqqq",
                    Unit: "qqqqqqqqqqqqqq"
                }
                $.each(sampleData,function(key,val){
                    $scope.$form.find('[name='+key.toLowerCase()+']').val(val);
                });
            }
            /* Reset Form
          ---------------------------------------*/
            $scope.formreset = function () {
                $scope.$form.find("input[type=tel],input[type=text], textarea").val("");
                $scope.showErrorMessage = false;
                $scope.showSuccessMessage = false;
                $scope.$form.find('input').removeAttr('disabled');
                $scope.$form.find('button').show();
                $scope.$form.find('.done-btn').hide();
                $scope.submitted = false;
            }
            /* Submit Form
          ---------------------------------------*/
            $scope.formsubmit = function () {
                $scope.submitted = true;

                if($scope.$form.find('.ng-invalid').length > 0 ){
                    return false;
                }

                // Filtering Form
                if('$iv-filtering-form' === 'true'){
                    $rootScope.$broadcast('$iv-name', $element.find('form'));
                    // Ajax Form
                }else{
                    $element.find('form [type=submit]').button('loading');
                    $http({
                        method  : 'POST',
                        url     : rootControllerUrl + "$iv-controller/$iv-action",
                        data    : $element.find('form').serialize(),
                        headers : { 'Content-Type': 'application/x-www-form-urlencoded' }
                    }).
                    success(function (responseData, status, headers, config) {
                        $scope.isFormSubmitted = true;
                        $scope.result = responseData;
                        if (responseData.HasError == 'True')
                        {
                            $scope.showErrorMessage = true;
                            $scope.showSuccessMessage = false;
                            $scope.error = responseData.Error;
                        }
                        else
                        {
                            $scope.showErrorMessage =false;
                            $scope.showSuccessMessage = true;
                            $rootScope.$broadcast('$iv-name', responseData);
                            if ("$iv-redirecturl" !== "null"){
                                $window.location = "$iv-redirecturl";
                            }
                        }
                        $rootScope.$broadcast('$iv-name',responseData);
                        $element.find('form [type=submit]').button('reset');
                        if($iv-show-modal !== false){
                            $('#formSuccessModal').modal('show');
                            $element.find('form').find("input[type=tel],input[type=text], textarea").val("");
                        }
                        if($iv-single-submit){
                            $scope.$form.find('input').attr('disabled','disabled');
                            $scope.$form.find('button').hide();
                            $scope.$form.find('.done-btn').show();
                        }
                        setTimeout(function(){
                            $(window).trigger('resize');
                        }, 600);
                    }).
                    error(function (responseData, status, headers, config) {
                        $scope.showErrorMessage =true;
                        $scope.showSuccessMessage = false;
                        $scope.isFormSubmitted = true;
                        $scope.result = responseData;
                        $scope.error = responseData.Error;
                        $element.find('form [type=submit]').button('reset');
                    });
                }
            };

            $scope.phoneNumberPattern = (function() {
                var regexp =  /^\d+$/;
                return {
                    test: function(value) {
                        if( $scope.requireTel === false ) {
                            return true;
                        }
                        return regexp.test(value);
                    }
                };
            })();

        }
    </script>
</control>